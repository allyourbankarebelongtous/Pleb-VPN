{% extends "base.html" %} {% block title %}Payments{% endblock %} {% block
content %}
<div class="container text-center">
  <div class="row">
    <div class="col">
      <h3>Manage Payments</h3>
    </div>
  </div>
</div>
<br />
<div class="container">
  {% if current_payments is not none %}
  <div class="row">
    <div class="col text-center">
      <h4>Current Payments</h4>
    </div>
  </div>
  {% if current_payments['daily']|length > 0 %} {% for line in
  current_payments['daily'] %}
  <div
    class="row"
    id="payment_info{{ line[0] }}"
    style="border-top: 1px solid lightgrey"
  >
    <div class="col-3">
      <div class="row" style="margin-top: 0.5em">
        <div class="col">
          <h5>Daily Payment</h5>
          <p><small>every night at midnight</small></p>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <div class="btn-group">
            <button
              class="btn btn-sm dropdown-toggle"
              type="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              Options
            </button>
            <ul class="dropdown-menu">
              <li>
                <a
                  class="dropdown-item"
                  href="#"
                  onClick="send_payment('{{ line[0] }}')"
                  >Send Now</a
                >
              </li>
              <li>
                <a
                  class="dropdown-item"
                  href="#"
                  onClick="edit_payment('{{ line[0] }}')"
                  >Edit</a
                >
              </li>
              <li>
                <a
                  class="dropdown-item"
                  href="#"
                  onClick="delete_payment('{{ line[0] }}')"
                >
                  Delete
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="col-9">
      <table class="table">
        <tbody>
          <tr>
            <th scope="row">Destination Pubkey</th>
            <td>{{ line[1] }}</td>
          </tr>
          <tr>
            <th scope="row">Amount</th>
            <td>{{ line[2] }} {{ line[3] }}</td>
          </tr>
          <tr>
            <th scope="row">Message</th>
            <td>{{ line[4] }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div
    class="row d-none"
    id="payment_edit{{ line[0] }}"
    style="border-top: 1px solid lightgrey"
  >
    <form method="POST" id="payment_edit_form{{ line[0] }}">
      <div class="row">
        <table class="table">
          <tbody>
            <tr>
              <th scope="row">Destination Pubkey</th>
              <td>
                <input
                  type="text"
                  id="pubkey"
                  name="pubkey"
                  value="{{ line[1] }}"
                />
              </td>
            </tr>
            <tr>
              <th scope="row">Amount in sats or USD</th>
              <td>
                <input
                  type="text"
                  id="amount"
                  name="amount"
                  value="{{ line[2] }}"
                />
              </td>
            </tr>
            <tr>
              <th scope="row">Denomination</th>
              <td>
                {% if line[3] == "sats" %}
                <select
                  class="form-control"
                  id="denomination"
                  name="denomination"
                >
                  <option value="sats" selected>sats</option>
                  <option value="USD">USD</option>
                </select>
                {% else %}
                <select
                  class="form-control"
                  id="denomination"
                  name="denomination"
                >
                  <option value="sats">sats</option>
                  <option value="USD" selected>USD</option>
                </select>
                {% endif %}
              </td>
            </tr>
            <tr>
              <th scope="row">Message (optional)</th>
              <td>
                <input
                  type="text"
                  id="message"
                  name="message"
                  value="{{ line[4] }}"
                />
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="row" style="margin-top: 0.5em">
        <div class="col">
          <label for="frequency"
            >How often do you want to send this payment?</label
          >
          <select class="form-control" id="frequency" name="frequency">
            <option value="daily" selected>Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
            <option value="yearly">Yearly</option>
          </select>
        </div>
        <div class="col text-center">
          <button
            type="button"
            class="btn btn-success"
            onClick="save_edited_payment('{{ line[0] }}')"
          >
            Save
          </button>
        </div>
        <div class="col text-center">
          <button
            type="button"
            class="btn btn-danger"
            onClick="cancel_edited_payment('{{ line[0] }}')"
          >
            Cancel
          </button>
        </div>
      </div>
    </form>
  </div>

  {% endfor %} {% endif %} {% if current_payments['weekly']|length > 0 %} {% for
  line in current_payments['weekly'] %}
  <div class="row" style="border-top: 1px solid lightgrey">
    <div class="col-3">
      <div class="row" style="margin-top: 0.5em">
        <div class="col">
          <h5>Weekly Payment</h5>
          <p><small>every saturday night at midnight</small></p>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <button
            id="send_payment"
            type="button"
            class="btn btn-success"
            onClick="send_payment({{ line[0] }})"
          >
            Send
          </button>
          <button id="edit_payment" type="button" class="btn btn-primary">
            Edit
          </button>
          <button
            id="delete_payment"
            type="button"
            class="btn btn-danger"
            onClick="delete_payment({{ line[0] }})"
          >
            Delete
          </button>
        </div>
      </div>
    </div>
    <div class="col-9">
      <table class="table">
        <tbody>
          <tr>
            <th scope="row">Destination Pubkey</th>
            <td>{{ line[1] }}</td>
          </tr>
          <tr>
            <th scope="row">Amount</th>
            <td>{{ line[2] }} {{ line[3] }}</td>
          </tr>
          <tr>
            <th scope="row">Message</th>
            <td>{{ line[4] }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  {% endfor %} {% endif %} {% if current_payments['monthly']|length > 0 %} {%
  for line in current_payments['monthly'] %}
  <div class="row" style="border-top: 1px solid lightgrey">
    <div class="col-3">
      <div class="row" style="margin-top: 0.5em">
        <div class="col">
          <h5>Monthly Payment</h5>
          <p>
            <small>every last night of the month at midnight</small>
          </p>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <button
            id="send_payment"
            type="button"
            class="btn btn-success"
            onClick="send_payment({{ line[0] }})"
          >
            Send
          </button>
          <button id="edit_payment" type="button" class="btn btn-primary">
            Edit
          </button>
          <button
            id="delete_payment"
            type="button"
            class="btn btn-danger"
            onClick="delete_payment({{ line[0] }})"
          >
            Delete
          </button>
        </div>
      </div>
    </div>
    <div class="col-9">
      <table class="table">
        <tbody>
          <tr>
            <th scope="row">Destination Pubkey</th>
            <td>{{ line[1] }}</td>
          </tr>
          <tr>
            <th scope="row">Amount</th>
            <td>{{ line[2] }} {{ line[3] }}</td>
          </tr>
          <tr>
            <th scope="row">Message</th>
            <td>{{ line[4] }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  {% endfor %} {% endif %} {% if current_payments['yearly']|length > 0 %} {% for
  line in current_payments['yearly'] %}
  <div class="row" style="border-top: 1px solid lightgrey">
    <div class="col-3">
      <div class="row" style="margin-top: 0.5em">
        <div class="col">
          <h5>Yearly Payment</h5>
          <p><small>every Dec 31st at midnight</small></p>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <button
            id="send_payment"
            type="button"
            class="btn btn-success"
            onClick="send_payment({{ line[0] }})"
          >
            Send
          </button>
          <button id="edit_payment" type="button" class="btn btn-primary">
            Edit
          </button>
          <button
            id="delete_payment"
            type="button"
            class="btn btn-danger"
            onClick="delete_payment({{ line[0] }})"
          >
            Delete
          </button>
        </div>
      </div>
    </div>
    <div class="col-9">
      <table class="table">
        <tbody>
          <tr>
            <th scope="row">Destination Pubkey</th>
            <td>{{ line[1] }}</td>
          </tr>
          <tr>
            <th scope="row">Amount</th>
            <td>{{ line[2] }} {{ line[3] }}</td>
          </tr>
          <tr>
            <th scope="row">Message</th>
            <td>{{ line[4] }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  {% endfor %}
</div>

{% endif %} {% endif %}
<br />
<div class="container">
  <div class="row">
    <div class="col text-center">
      <h4>Schedule New Payment</h4>
    </div>
  </div>
  <form method="POST">
    <div class="row" style="border-top: 1px solid lightgrey">
      <div class="col text-center">
        <div class="row">
          <div class="col">
            <h5>Frequency</h5>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label for="frequency"
              >How often do you want to send this payment?</label
            >
            <select class="form-control" id="frequency" name="frequency">
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
              <option value="yearly">Yearly</option>
            </select>
          </div>
        </div>
        <br />
        <div class="row">
          <div class="col text-center">
            <button
              type="button"
              class="btn btn-success"
              onClick="this.form.submit()"
            >
              Schedule New Payment
            </button>
          </div>
        </div>
      </div>

      <div class="col-9">
        <table class="table">
          <tbody>
            <tr>
              <th scope="row">Destination Pubkey</th>
              <td>
                <input
                  type="text"
                  id="pubkey"
                  name="pubkey"
                  placeholder="Enter destination pubkey"
                />
              </td>
            </tr>
            <tr>
              <th scope="row">Amount in sats or USD (use x.xx for USD)</th>
              <td>
                <input
                  type="text"
                  id="amount"
                  name="amount"
                  placeholder="Enter amount"
                />
              </td>
            </tr>
            <tr>
              <th scope="row">Denomination</th>
              <td>
                <select
                  class="form-control"
                  id="denomination"
                  name="denomination"
                >
                  <option value="sats">sats</option>
                  <option value="USD">USD</option>
                </select>
              </td>
            </tr>
            <tr>
              <th scope="row">Message</th>
              <td>
                <input
                  type="text"
                  id="messsage"
                  name="message"
                  placeholder="Enter message"
                />
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </form>
  <br />
  <div class="row">
    <div class="col text-center">
      <div class="row text-center">
        <h4>Delete All Payments</h4>
      </div>
      <div class="row">
        <div class="col text-center">
          <button
            id="delete_all_payments"
            type="button"
            class="btn btn-danger"
            onClick="delete_all_payments({{ current_user.id }})"
          >
            Delete All
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
