{% extends "base.html" %} {% block title %}Home{% endblock %} {% block content
%}
<div class="container">
  <div class="row">
    <div class="col text-center">
      <img
        src="{{ url_for('static', filename='full-logo cutout-orange.png') }}"
        style="height: 80px"
        alt="PlebNet logo"
        loading="lazy"
      />
    </div>
  </div>
  <div class="row">
    <div class="col text-center">
      <button
        id="activate"
        type="button"
        class="btn btn-success"
        onClick="refreshplebVPNdata({{ current_user.id }})"
      >
        Refesh Data
      </button>
      <button
        id="activate_loading"
        class="btn btn-success d-none"
        type="button"
        disabled
      >
        <span
          class="spinner-grow spinner-grow-sm"
          role="status"
          aria-hidden="true"
        ></span>
        Loading...
      </button>
    </div>
  </div>
</div>
<br />

<div class="container container-fluid">
  <div class="row">
    <div class="col">
      <div class="row">
        <div class="col">
          <h2 align="center">VPN Status</h2>
        </div>
      </div>

      {% if plebVPN_status['message'] != null %}
      <div class="row">
        <div class="col text-center" style="border-top: 1px solid lightgrey">
          <h7>{{ plebVPN_status['message'] }}</h7>
        </div>
      </div>
      {% endif %}

      <div class="row">
        <div class="col" style="border-top: 1px solid lightgrey">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Setting</th>
                <th scope="col">Value</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">Pleb-VPN Status</th>
                <td>{{ setting['plebvpn'] }}</td>
              </tr>
              <tr>
                <th scope="row">Pleb-VPN Operating</th>
                <td>{{ plebVPN_status['vpn_operating'] }}</td>
              </tr>
              {% if setting['plebvpn'] == "on" %}
              <tr>
                <th scope="row">Current IP</th>
                <td>{{ plebVPN_status['current_ip'] }}</td>
              </tr>
              <tr>
                <th scope="row">Pleb-VPN IP</th>
                <td>{{ setting['vpnip'] }}</td>
              </tr>
              <tr>
                <th scope="row">Pleb-VPN Port for VPS</th>
                <td>{{ setting['vpnport'] }}</td>
              </tr>
              <tr>
                <th scope="row">Firewall Config OK</th>
                <td>{{ plebVPN_status['firewall_configured'] }}</td>
              </tr>
              {% endif %}
              <tr>
                <th scope="row">VPN config file exists</th>
                <td>{{ plebVPN_status['config_exists'] }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  {% if lnd %}
  <div class="row">
    <div class="col">
      <div class="row">
        <div class="col text-center">
          <h2>LND Hybrid Status</h2>
        </div>
      </div>
      <div class="row">
        <div class="col" style="border-top: 1px solid lightgrey">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Setting</th>
                <th scope="col">Value</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">LND Alias</th>
                <td>{{ lnd_hybrid_status['Alias'] }}</td>
              </tr>
              <tr>
                <th scope="row">LND Node ID</th>
                <td>{{ lnd_hybrid_status['Node_ID'] }}</td>
              </tr>
              <tr>
                <th scope="row">LND Hybrid Status</th>
                <td>{{ setting['lndhybrid'] }}</td>
              </tr>
              <tr>
                <th scope="row">LND Hybrid Port</th>
                <td>{{ setting['lnport'] }}</td>
              </tr>
              <tr>
                {% if lnd_hybrid_status['address0Type'] == 'torv3' %}
                <th scope="row">LND Tor Address</th>
                {% else %}
                <th scope="row">LND IPV4 Address</th>
                {% endif %}
                <td>{{ lnd_hybrid_status['address0'] }}</td>
              </tr>
              {% if setting['lndhybrid'] == "on" %}
              <tr>
                {% if lnd_hybrid_status['address1Type'] == 'torv3' %}
                <th scope="row">LND Tor Address</th>
                {% else %}
                <th scope="row">LND IPV4 Address</th>
                {% endif %}
                <td>{{ lnd_hybrid_status['address1'] }}</td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  {% endif %} {% if cln %}
  <div class="row">
    <div class="col">
      <div class="row">
        <div class="col text-center">
          <h2>Core Lightning Hybrid Status</h2>
        </div>
      </div>
      <div class="row">
        <div class="col" style="border-top: 1px solid lightgrey">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Setting</th>
                <th scope="col">Value</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">Core Lightning Alias</th>
                <td>{{ cln_hybrid_status['Alias'] }}</td>
              </tr>
              <tr>
                <th scope="row">Core Lightning Node ID</th>
                <td>{{ cln_hybrid_status['Node_ID'] }}</td>
              </tr>
              <tr>
                <th scope="row">Core Lightning Hybrid Status</th>
                <td>{{ setting['clnhybrid'] }}</td>
              </tr>
              <tr>
                <th scope="row">Core Lightning Hybrid Port</th>
                <td>{{ setting['clnport'] }}</td>
              </tr>
              <tr>
                {% if cln_hybrid_status['address0Type'] == 'torv3' %}
                <th scope="row">Core Lightning Tor Address</th>
                {% else %}
                <th scope="row">Core Lightning IPV4 Address</th>
                {% endif %}
                <td>{{ cln_hybrid_status['address0'] }}</td>
              </tr>
              {% if setting['clnhybrid'] == "on" %}
              <tr>
                {% if lnd_hybrid_status['address1Type'] == 'torv3' %}
                <th scope="row">Core Lightning Tor Address</th>
                {% else %}
                <th scope="row">Core Lightning IPV4 Address</th>
                {% endif %}
                <td>{{ cln_hybrid_status['address1'] }}</td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
  <div class="row">
    <div class="col">
      <div class="row">
        <div class="col">
          <h2 align="center">Wireguard LAN Status</h2>
        </div>
      </div>

      {% if wireguard_status['message'] != null %}
      <div class="row">
        <div class="col text-center" style="border-top: 1px solid lightgrey">
          <h7 align="center">{{ wireguard_status['message'] }}</h7>
        </div>
      </div>
      {% endif %}

      <div class="row">
        <div class="col" style="border-top: 1px solid lightgrey">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Setting</th>
                <th scope="col">Value</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">Wireguard Status</th>
                <td>{{ setting['wireguard'] }}</td>
              </tr>
              {% if setting['wgport'] != "" %}
              <tr>
                <th scope="row">Wireguard Port</th>
                <td>{{ setting['wgport'] }}</td>
              </tr>
              {% endif %}
              <tr>
                <th scope="row">Existing config found</th>
                <td>{{ wireguard_status['config_file_found'] }}</td>
              </tr>
              {% if setting['wireguard'] == "on" %}
              <tr>
                <th scope="row">Wireguard Operating</th>
                <td>{{ wireguard_status['operating'] }}</td>
              </tr>
              <tr>
                <th scope="row">Wireguard Node IP</th>
                <td>{{ wireguard_status['server_IP'] }}</td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
      {% if setting['wireguard'] == "on" %}
      <div class="row">
        <div class="col text-center">
          <p>
            Use the Wireguard page in the settings menu to download client
            config files or qr codes.
          </p>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
  <div class="row">
    <div class="col text-center" style="border-top: 1px solid lightgrey">
      <h2>Pleb-VPN Status</h2>
    </div>
  </div>
  <div class="row">
    <div class="col text-center">
      <table class="table">
        <tbody>
          <tr>
            <th scope="row">Current Version</th>
            <td>{{ setting['version'] }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  {% if update_available == True %}
  <div class="row">
    <div class="col text-center">
      <h5>Update Pleb-VPN</h5>
      <p>
        A Pleb-VPN update is available. To update, click "Update Pleb-VPN".
        Pleb-VPN will update and restart. Your settings will be unaffected.
      </p>
    </div>
  </div>
  <div class="row">
    <div class="col text-center">
      <button id="update-scripts" type="button" class="btn btn-primary">
        Update Pleb-VPN
      </button>
      <button
        id="update-scripts_loading"
        class="btn btn-primary d-none"
        type="button"
        disabled
      >
        <span
          class="spinner-grow spinner-grow-sm"
          role="status"
          aria-hidden="true"
        ></span>
        Loading...
      </button>
    </div>
  </div>
  {% endif %}
  <div class="row">
    <div class="col text-center">
      <h5>Uninstall Pleb-VPN</h5>
    </div>
  </div>
  <div class="row">
    <div class="col text-center">
      <button id="uninstall-plebvpn" type="button" class="btn btn-danger">
        Uninstall Pleb-VPN
      </button>
    </div>
  </div>
</div>
<script>
  var socket = io.connect("http://" + document.domain + ":" + location.port);
  $("#update-scripts").click(function () {
    event.preventDefault();
    if (
      confirm_dialog(
        (message =
          "Pleb-VPN will restart. Your settings will be unchanged. Are you sure you want to update Pleb-VPN?")
      ) == true
    ) {
      var updateBtn = document.getElementById("update-scripts");
      if (updateBtn !== null) {
        updateBtn.classList.add("d-none");
      }
      var updateLoading = document.getElementById("update-scripts_loading");
      if (updateLoading !== null) {
        updateLoading.classList.remove("d-none");
      }
      socket.emit("update_scripts");
    }
  });
  $("#uninstall-plebvpn").click(function () {
    event.preventDefault();
    if (
      confirm_dialog(
        (message =
          "This will completely remove Pleb-VPN and all services from your node, restoring it to its original configuration. Are you sure you want to uninstall Pleb-VPN?")
      ) == true
    ) {
      socket.emit("uninstall-plebvpn");
    }
  });
</script>
{% endblock %}
